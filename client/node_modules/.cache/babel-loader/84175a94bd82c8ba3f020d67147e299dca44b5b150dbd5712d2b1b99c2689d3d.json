{"ast":null,"code":"import _objectSpread from\"C:/Sites/pqueue/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from\"react\";import axios from\"axios\";import\"./styles/queueStyles.css\";import{calculateETC}from\"./utils/calculateETC\";import{sendWhatsAppNotification}from\"./utils/sendWhatsAppNotification\";// Use environment variable or relative URL for API\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const BASE_URL=process.env.REACT_APP_API_URL||\"\";const getOrderClass=category=>{if(category===\"New Mix\")return\"urgent\";if(category===\"Reorder Mix\")return\"warning\";if(category===\"Colour Code\")return\"standard\";return\"\";};const Dashboard=()=>{const[orders,setOrders]=useState([]);const[activeOrdersCount,setActiveOrdersCount]=useState(0);const[error,setError]=useState(\"\");const[loading,setLoading]=useState(false);// Fetch orders\nconst fetchOrders=useCallback(async()=>{setLoading(true);setError(\"\");try{const response=await axios.get(\"\".concat(BASE_URL,\"/api/orders\"));const updatedOrders=response.data.map(order=>_objectSpread(_objectSpread({},order),{},{dynamicETC:calculateETC(order.category,activeOrdersCount)||\"N/A\"}));setOrders(updatedOrders);}catch(error){setError(\"Error fetching orders.\");}finally{setLoading(false);}},[activeOrdersCount]);// Fetch active orders count\nconst fetchActiveOrdersCount=async()=>{try{const response=await axios.get(\"\".concat(BASE_URL,\"/api/active-orders-count\"));setActiveOrdersCount(response.data.activeOrders);}catch(error){setError(\"Error fetching active orders count.\");}};useEffect(()=>{fetchOrders();fetchActiveOrdersCount();},[fetchOrders]);const updateStatus=async(orderId,newStatus,clientNumber)=>{try{await axios.put(\"\".concat(BASE_URL,\"/api/orders/\").concat(orderId),{current_status:newStatus});fetchOrders();if(newStatus===\"Ready\"){sendWhatsAppNotification(clientNumber,orderId,calculateETC(newStatus,activeOrdersCount));}}catch(error){setError(\"Error updating order status.\");}};return/*#__PURE__*/_jsxs(\"div\",{className:\"container mt-4\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-center\",children:\"Paints Queue Dashboard\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Active Orders: \",/*#__PURE__*/_jsx(\"strong\",{children:activeOrdersCount})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",children:error}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary mb-2\",onClick:fetchOrders,disabled:loading,children:loading?\"Refreshing...\":\"Refresh\"}),/*#__PURE__*/_jsxs(\"table\",{className:\"table table-bordered\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Transaction ID\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Color Code\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Paint Type\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Start Time\"}),/*#__PURE__*/_jsx(\"th\",{children:\"ETC\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Client Contact\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Action\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:orders.map(order=>/*#__PURE__*/_jsxs(\"tr\",{className:getOrderClass(order.category),children:[/*#__PURE__*/_jsx(\"td\",{children:order.transaction_id}),/*#__PURE__*/_jsx(\"td\",{children:order.colour_code!==undefined?order.colour_code:\"N/A\"}),/*#__PURE__*/_jsx(\"td\",{children:order.paint_type}),/*#__PURE__*/_jsx(\"td\",{children:order.start_time}),/*#__PURE__*/_jsx(\"td\",{children:order.dynamicETC}),/*#__PURE__*/_jsx(\"td\",{children:order.current_status}),/*#__PURE__*/_jsx(\"td\",{children:order.client_contact}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"select\",{className:\"form-select\",value:order.current_status,onChange:e=>updateStatus(order.id,e.target.value,order.client_contact),children:[/*#__PURE__*/_jsx(\"option\",{value:order.current_status,children:order.current_status}),![\"Mixing\",\"Ready\"].includes(order.current_status)&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"option\",{value:\"Mixing\",children:\"Mixing\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Ready\",children:\"Ready\"})]})]})})]},order.id))})]})]});};export default Dashboard;","map":{"version":3,"names":["React","useState","useEffect","useCallback","axios","calculateETC","sendWhatsAppNotification","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","BASE_URL","process","env","REACT_APP_API_URL","getOrderClass","category","Dashboard","orders","setOrders","activeOrdersCount","setActiveOrdersCount","error","setError","loading","setLoading","fetchOrders","response","get","concat","updatedOrders","data","map","order","_objectSpread","dynamicETC","fetchActiveOrdersCount","activeOrders","updateStatus","orderId","newStatus","clientNumber","put","current_status","className","children","onClick","disabled","transaction_id","colour_code","undefined","paint_type","start_time","client_contact","value","onChange","e","id","target","includes"],"sources":["C:/Sites/pqueue/client/src/Dashboard.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\";\r\nimport axios from \"axios\";\r\nimport \"./styles/queueStyles.css\";\r\nimport { calculateETC } from \"./utils/calculateETC\";\r\nimport { sendWhatsAppNotification } from \"./utils/sendWhatsAppNotification\";\r\n\r\n// Use environment variable or relative URL for API\r\nconst BASE_URL = process.env.REACT_APP_API_URL || \"\";\r\n\r\nconst getOrderClass = (category) => {\r\n    if (category === \"New Mix\") return \"urgent\";\r\n    if (category === \"Reorder Mix\") return \"warning\";\r\n    if (category === \"Colour Code\") return \"standard\";\r\n    return \"\";\r\n};\r\n\r\nconst Dashboard = () => {\r\n    const [orders, setOrders] = useState([]);\r\n    const [activeOrdersCount, setActiveOrdersCount] = useState(0);\r\n    const [error, setError] = useState(\"\");\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    // Fetch orders\r\n    const fetchOrders = useCallback(async () => {\r\n        setLoading(true);\r\n        setError(\"\");\r\n        try {\r\n            const response = await axios.get(`${BASE_URL}/api/orders`);\r\n            const updatedOrders = response.data.map(order => ({\r\n                ...order,\r\n                dynamicETC: calculateETC(order.category, activeOrdersCount) || \"N/A\"\r\n            }));\r\n            setOrders(updatedOrders);\r\n        } catch (error) {\r\n            setError(\"Error fetching orders.\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [activeOrdersCount]);\r\n\r\n    // Fetch active orders count\r\n    const fetchActiveOrdersCount = async () => {\r\n        try {\r\n            const response = await axios.get(`${BASE_URL}/api/active-orders-count`);\r\n            setActiveOrdersCount(response.data.activeOrders);\r\n        } catch (error) {\r\n            setError(\"Error fetching active orders count.\");\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        fetchOrders();\r\n        fetchActiveOrdersCount();\r\n    }, [fetchOrders]);\r\n\r\n    const updateStatus = async (orderId, newStatus, clientNumber) => {\r\n        try {\r\n            await axios.put(`${BASE_URL}/api/orders/${orderId}`, { current_status: newStatus });\r\n            fetchOrders();\r\n            if (newStatus === \"Ready\") {\r\n                sendWhatsAppNotification(clientNumber, orderId, calculateETC(newStatus, activeOrdersCount));\r\n            }\r\n        } catch (error) {\r\n            setError(\"Error updating order status.\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"container mt-4\">\r\n            <h1 className=\"text-center\">Paints Queue Dashboard</h1>\r\n            <p>Active Orders: <strong>{activeOrdersCount}</strong></p>\r\n            {error && <div className=\"alert alert-danger\">{error}</div>}\r\n            <button className=\"btn btn-secondary mb-2\" onClick={fetchOrders} disabled={loading}>\r\n                {loading ? \"Refreshing...\" : \"Refresh\"}\r\n            </button>\r\n            <table className=\"table table-bordered\">\r\n                <thead>\r\n                    <tr>\r\n                        <th>Transaction ID</th>\r\n                        <th>Color Code</th>\r\n                        <th>Paint Type</th>\r\n                        <th>Start Time</th>\r\n                        <th>ETC</th>\r\n                        <th>Status</th>\r\n                        <th>Client Contact</th>\r\n                        <th>Action</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    {orders.map(order => (\r\n                        <tr key={order.id} className={getOrderClass(order.category)}>\r\n                            <td>{order.transaction_id}</td>\r\n                            <td>{order.colour_code !== undefined ? order.colour_code : \"N/A\"}</td>\r\n                            <td>{order.paint_type}</td>\r\n                            <td>{order.start_time}</td>\r\n                            <td>{order.dynamicETC}</td>\r\n                            <td>{order.current_status}</td>\r\n                            <td>{order.client_contact}</td>\r\n                            <td>\r\n                                <select\r\n                                    className=\"form-select\"\r\n                                    value={order.current_status}\r\n                                    onChange={(e) => updateStatus(order.id, e.target.value, order.client_contact)}\r\n                                >\r\n                                    <option value={order.current_status}>{order.current_status}</option>\r\n                                    {![\"Mixing\", \"Ready\"].includes(order.current_status) && (\r\n                                        <>\r\n                                            <option value=\"Mixing\">Mixing</option>\r\n                                            <option value=\"Ready\">Ready</option>\r\n                                        </>\r\n                                    )}\r\n                                </select>\r\n                            </td>\r\n                        </tr>\r\n                    ))}\r\n                </tbody>\r\n            </table>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Dashboard;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}